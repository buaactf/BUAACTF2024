# 赛题设计说明

## 题目信息

- 题目名称：264的秘密
- 预估难度：困难

## 题目描述

小J捕获了嫌疑人电脑上的流量，发现他在朝某个服务器发送些什么……

## 考点

1. RTMP（Real-Time Messaging Protocol）流量分析
2. H264编码规范
3. NALU编码规范
4. ffmpeg工具使用

## 出题思路与解题思路

### 出题思路
主要考察当前主流视频协议规范H264的内容，FLV、MP4等视频格式都是一种封装，想要提取视频真正的内容，需要从封装格式中提取H264裸流。

对于H264裸流，NALU是视频信息的承载单元，从H264裸流分析NALU。其中H264用I帧、P帧、B帧来记录视频，通过修改特定NALU的帧类型，就可以让视频损坏。

### 解题思路

打开流量，先导出rtmp流内容，然后从中提取出flv视频文件。 提取出来的视频是损坏的，根据题目提示，提取H264裸流进行分析。

用ffmpeg工具转换为H264裸流，然后用H264BSanalyzer查看裸流。

第一，会发现所有视频帧都被改成B帧，不过在IDR帧的下面都有一个SEI帧储存了IBP帧的顺序，可以通过此还原正常的IPB帧顺序。

第二，所有的IDR帧按照协议都应该是I帧，但是IDR帧类型都被改变成了11，未知的帧类型，导致视频无法正常播放，所以将IDR帧的帧类型改为I帧。

修改完毕后，保存裸流，并转换为flv文件，即修复成功，能够看到flag。

## 提示

1. 怎么提取H264裸流呢
2. 怎么分析NALU呢
3. SEI有什么用
4. I帧、P帧、B帧

## 参考

H264协议规范

